
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Starting a Test Network &#8212; CCF  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/ccf.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-11 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../concepts.html">Overview</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../developers/index.html">Build Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../users/index.html">Use Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../operators/index.html">Operations</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../members/index.html">Governance</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../audit/index.html">Audit</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        
      </ul>

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Microsoft/CCF" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<script>
    function onVersionChange() {
      window.location.href = document.getElementById("versions").value;
    }

    window.addEventListener("DOMContentLoaded",function(){
        let selectedVersion = "master"
        const thisURL = window.location.toString()
        let indexOfVersion = thisURL.indexOf("ccf-")
        if (indexOfVersion != -1) {
            selectedVersion = thisURL.substring(indexOfVersion, thisURL.indexOf("/", indexOfVersion));
        }
        let sel = document.getElementById("versions");
        if (sel != null) {
            let opts = sel.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.text == selectedVersion) {
                    sel.selectedIndex = j;
                    break;
                }
            }
        }
    }, false);
</script>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
        

        <ul class="nav bd-sidenav">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </ul>

        
        <h6> Versions </h6>
        <select name="versions" id="versions" class="custom-select custom-select-sm" style="width:50%" onchange="onVersionChange()">
            <option value="../../master/index.html">master </option>
            <option value="../../ccf-0.17.2/index.html">ccf-0.17.2 </option>
            <option value="../../ccf-0.17.1/index.html">ccf-0.17.1 </option>
            <option value="../../ccf-0.17.0/index.html">ccf-0.17.0 </option>
            <option value="../../ccf-0.16.3/index.html">ccf-0.16.3 </option>
            <option value="../../ccf-0.16.2/index.html">ccf-0.16.2 </option>
            <option value="../../ccf-0.16.1/index.html">ccf-0.16.1 </option>
            <option value="../../ccf-0.16.0/index.html">ccf-0.16.0 </option>
            <option value="../../ccf-0.15.2/index.html">ccf-0.15.2 </option>
            <option value="../../ccf-0.15.1/quickstart/test_network.html">ccf-0.15.1 </option>
            <option value="../../ccf-0.15.0/quickstart/test_network.html">ccf-0.15.0 </option>
            <option value="../../ccf-0.14.3/quickstart/test_network.html">ccf-0.14.3 </option>
            <option value="../../ccf-0.14.2/quickstart/test_network.html">ccf-0.14.2 </option>
            <option value="test_network.html">ccf-0.14.1 </option>
            <option value="../../ccf-0.14.0/index.html">ccf-0.14.0 </option>
            <option value="../../ccf-0.13.4/index.html">ccf-0.13.4 </option>
            <option value="../../ccf-0.13.3/index.html">ccf-0.13.3 </option>
            <option value="../../ccf-0.13.2/index.html">ccf-0.13.2 </option>
            <option value="../../ccf-0.13.1/index.html">ccf-0.13.1 </option>
            <option value="../../ccf-0.13.0/index.html">ccf-0.13.0 </option>
            <option value="../../ccf-0.12.2/index.html">ccf-0.12.2 </option>
            <option value="../../ccf-0.12.1/index.html">ccf-0.12.1 </option>
            <option value="../../ccf-0.12.0/index.html">ccf-0.12.0 </option>
            <option value="../../ccf-0.11.7/index.html">ccf-0.11.7 </option>
            <option value="../../ccf-0.11.4/index.html">ccf-0.11.4 </option>
            <option value="../../ccf-0.11.1/index.html">ccf-0.11.1 </option>
        </select>
        
</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#recovering-a-service" class="nav-link">Recovering a Service</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/Microsoft/CCF/edit/master/doc/quickstart/test_network.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="starting-a-test-network">
<h1>Starting a Test Network<a class="headerlink" href="#starting-a-test-network" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before starting a CCF test network, make sure that:</p>
<ul class="simple">
<li><p>The CCF runtime environment has successfully been setup (see <a class="reference internal" href="run_setup.html#setup-ccf-runtime-environment"><span class="std std-ref">environment setup instructions</span></a>).</p></li>
<li><p>CCF is installed (see <a class="reference internal" href="install.html#install"><span class="std std-ref">installation steps</span></a>)</p></li>
</ul>
</div>
<p>The quickest way to start a CCF test network is to use the <a class="reference external" href="https://github.com/microsoft/CCF/blob/master/start_test_network.sh">start_test_network.sh</a> test script, specifying the <a class="reference internal" href="../developers/index.html"><span class="doc">enclave image</span></a> to run.</p>
<p>The script creates a new test CCF network composed of 3 nodes running locally. All the governance requests required to open the network to users are automatically issued.</p>
<p>For example, deploying the <code class="docutils literal notranslate"><span class="pre">liblogging</span></code> example application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> CCF/build
$ ../start_test_network.sh --package ./liblogging.enclave.so.signed
Setting up Python environment...
Python environment successfully setup
<span class="o">[</span><span class="m">14</span>:47:41.562<span class="o">]</span> Starting <span class="m">3</span> CCF nodes...
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span> Started CCF network with the following nodes:
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span>   Node <span class="o">[</span> <span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.177.10.108:37765
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span>   Node <span class="o">[</span> <span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.169.74.37:58343
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span>   Node <span class="o">[</span> <span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.131.108.179:50532
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span> You can now issue business transactions to the ./liblogging.enclave.so.signed application.
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span> Keys and certificates have been copied to the common folder: /path/to/test_network_common
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span> See https://microsoft.github.io/CCF/master/users/issue_commands.html <span class="k">for</span> more information.
<span class="o">[</span><span class="m">14</span>:48:12.138<span class="o">]</span> Press Ctrl+C to shutdown the network.
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>To use CCF <cite>virtual</cite> mode, the same command can be run with <code class="docutils literal notranslate"><span class="pre">TEST_ENCLAVE=virtual</span></code> set as environment variable and the virtual version of the enclave application passed to the script. For example <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">TEST_ENCLAVE=virtual</span> <span class="pre">../start_test_network.sh</span> <span class="pre">--package</span> <span class="pre">./liblogging.virtual.so</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> argument can be used to display all commands issued by operators and members to start the network.</p></li>
<li><p>Snapshots can be generated at regular intervals by the primary node of the service using the <code class="docutils literal notranslate"><span class="pre">--snapshot-tx-interval</span> <span class="pre">&lt;interval&gt;</span></code> option.</p></li>
</ul>
</div>
<p>The log files (<code class="docutils literal notranslate"><span class="pre">out</span></code> and <code class="docutils literal notranslate"><span class="pre">err</span></code>) and ledger directory (<code class="docutils literal notranslate"><span class="pre">&lt;node_id&gt;.ledger</span></code>) for each CCF node can be found under <code class="docutils literal notranslate"><span class="pre">./workspace/test_network_&lt;node_id&gt;</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first time the command is run, a Python virtual environment will be created. This may take a few seconds. It will not be run the next time the <code class="docutils literal notranslate"><span class="pre">start_test_network.sh</span></code> script is started.</p>
</div>
<p>In a different terminal, using the local IP address and port of the CCF nodes displayed by the command (e.g. <code class="docutils literal notranslate"><span class="pre">https://127.177.10.108:37765</span></code> for node <code class="docutils literal notranslate"><span class="pre">0</span></code>), it is then possible for users to <a class="reference internal" href="../users/issue_commands.html#issuing-commands"><span class="std std-ref">issue business requests</span></a>.</p>
<div class="section" id="recovering-a-service">
<h2>Recovering a Service<a class="headerlink" href="#recovering-a-service" title="Permalink to this headline">Â¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">start_test_network.sh</span></code> script can also be used to automatically recover a defunct network, as per the steps described <a class="reference internal" href="../members/accept_recovery.html#accepting-recovery-and-submitting-shares"><span class="std std-ref">here</span></a>. The ledger to be recovered (<code class="docutils literal notranslate"><span class="pre">--ledger-dir</span></code>) , the defunct network encryption public key (<code class="docutils literal notranslate"><span class="pre">--network-enc-pubk</span></code>) and the directory containing the members and users identities and the network encryption public key (<code class="docutils literal notranslate"><span class="pre">--common-dir</span></code>) should be passed as arguments to the script.</p>
<p>Additionally, if snapshots were generated by the defunct service (using the <code class="docutils literal notranslate"><span class="pre">--snapshot-tx-interval</span> <span class="pre">&lt;interval&gt;</span></code> option), the recovery procedure can be significantly speeded up by re-starting from the latest available snapshot (<code class="docutils literal notranslate"><span class="pre">--snapshot-dir</span></code>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> CCF/build
$ cp -r ./workspace/test_network_0/0.ledger .
$ cp -r ./workspace/test_network_0/snapshots . <span class="c1"># Optional, only if snapshots are available</span>
$ cp ./workspace/test_network_0/network_enc_pubk.pem .
$ ../start_test_network.sh -p liblogging.enclave.so.signed --recover --ledger-dir <span class="m">0</span>.ledger --network-enc-pubk network_enc_pubk.pem --common-dir ./workspace/test_network_common/ <span class="o">[</span>--snapshot-dir snapshots<span class="o">]</span>
<span class="o">[</span><span class="m">14</span>:50:19.746<span class="o">]</span> Starting <span class="m">3</span> CCF nodes...
<span class="o">[</span><span class="m">14</span>:50:19.746<span class="o">]</span> Recovering network from:
<span class="o">[</span><span class="m">14</span>:50:19.746<span class="o">]</span>  - Defunct network public encryption key: network_enc_pubk.pem
<span class="o">[</span><span class="m">14</span>:50:19.746<span class="o">]</span>  - Common directory: ./workspace/test_network_common/
<span class="o">[</span><span class="m">14</span>:50:19.746<span class="o">]</span>  - Ledger: <span class="m">0</span>.ledger
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span> Started CCF network with the following nodes:
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span>   Node <span class="o">[</span> <span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.191.152.111:40371
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span>   Node <span class="o">[</span> <span class="m">4</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.184.250.157:35113
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span>   Node <span class="o">[</span> <span class="m">5</span><span class="o">]</span> <span class="o">=</span> <span class="m">127</span>.175.51.36:34699
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span> You can now issue business transactions to the liblogging.enclave.so.signed application.
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span> Keys and certificates have been copied to the common folder: /path/to/test_network_common
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span> See https://microsoft.github.io/CCF/master/users/issue_commands.html <span class="k">for</span> more information.
<span class="o">[</span><span class="m">14</span>:50:24.388<span class="o">]</span> Press Ctrl+C to shutdown the network.
</pre></div>
</div>
<p>The effects of transactions committed by the defunct network should then be recovered. Users can also <a class="reference internal" href="../users/issue_commands.html#issuing-commands"><span class="std std-ref">issue new business requests</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--ledger-recovery-timeout</span></code> argument should be used to specify the maximum timeout (in seconds) that the script will wait for CCF to recover the ledger. Depending on the size of the ledger to recover, this timeout may have to be set to a large value.</p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, Microsoft Research.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>