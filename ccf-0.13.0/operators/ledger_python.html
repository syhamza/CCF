
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parsing the Ledger with Python &#8212; CCF  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Runtime Container" href="container.html" />
    <link rel="prev" title="Ledger" href="ledger.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/ccf.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-11 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../concepts.html">Concepts</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../quickstart/index.html">Start Here</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../members/index.html">Governance</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../developers/index.html">Building Apps</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Operations</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../users/index.html">Using Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        
      </ul>

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Microsoft/CCF" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<script>
    function onVersionChange() {
      window.location.href = document.getElementById("versions").value;
    }

    window.addEventListener("DOMContentLoaded",function(){
        let selectedVersion = "master"
        const thisURL = window.location.toString()
        let indexOfVersion = thisURL.indexOf("ccf-")
        if (indexOfVersion != -1) {
            selectedVersion = thisURL.substring(indexOfVersion, thisURL.indexOf("/", indexOfVersion));
        }
        let sel = document.getElementById("versions");
        if (sel != null) {
            let opts = sel.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.text == selectedVersion) {
                    sel.selectedIndex = j;
                    break;
                }
            }
        }
    }, false);
</script>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
        

        <ul class="nav bd-sidenav">
            
            
            
            
            
            
            
            
            
            
            
            
            <li class="">
                <a href="start_network.html">Starting a New Network</a>
            </li>
            
            
            
            <li class="">
                <a href="recovery.html">Catastrophic Recovery</a>
            </li>
            
            
            
            <li class="">
                <a href="node_output.html">Node Output</a>
            </li>
            
            
            
            <li class="">
                <a href="operator_rpc_api.html">Operator RPC API</a>
            </li>
            
            
            
            <li class="">
                <a href="resource_usage.html">Resource Usage</a>
            </li>
            
            
            
            <li class="">
                <a href="ledger.html">Ledger</a>
            </li>
            
            
            
            <li class="active">
                <a href="">Parsing the Ledger with Python</a>
            </li>
            
            
            
            <li class="">
                <a href="container.html">Runtime Container</a>
            </li>
            
            
            
            
            
            
            
            
        </ul>

        
        <h6> Versions </h6>
        <select name="versions" id="versions" class="custom-select custom-select-sm" style="width:50%" onchange="onVersionChange()">
            <option value="../../master/index.html">master </option>
            <option value="../../ccf-0.17.2/index.html">ccf-0.17.2 </option>
            <option value="../../ccf-0.17.1/index.html">ccf-0.17.1 </option>
            <option value="../../ccf-0.17.0/index.html">ccf-0.17.0 </option>
            <option value="../../ccf-0.16.3/index.html">ccf-0.16.3 </option>
            <option value="../../ccf-0.16.2/index.html">ccf-0.16.2 </option>
            <option value="../../ccf-0.16.1/index.html">ccf-0.16.1 </option>
            <option value="../../ccf-0.16.0/index.html">ccf-0.16.0 </option>
            <option value="../../ccf-0.15.2/index.html">ccf-0.15.2 </option>
            <option value="../../ccf-0.15.1/index.html">ccf-0.15.1 </option>
            <option value="../../ccf-0.15.0/index.html">ccf-0.15.0 </option>
            <option value="../../ccf-0.14.3/index.html">ccf-0.14.3 </option>
            <option value="../../ccf-0.14.2/index.html">ccf-0.14.2 </option>
            <option value="../../ccf-0.14.1/index.html">ccf-0.14.1 </option>
            <option value="../../ccf-0.14.0/operators/ledger_python.html">ccf-0.14.0 </option>
            <option value="../../ccf-0.13.4/operators/ledger_python.html">ccf-0.13.4 </option>
            <option value="../../ccf-0.13.3/operators/ledger_python.html">ccf-0.13.3 </option>
            <option value="../../ccf-0.13.2/operators/ledger_python.html">ccf-0.13.2 </option>
            <option value="../../ccf-0.13.1/operators/ledger_python.html">ccf-0.13.1 </option>
            <option value="ledger_python.html">ccf-0.13.0 </option>
            <option value="../../ccf-0.12.2/operators/ledger_python.html">ccf-0.12.2 </option>
            <option value="../../ccf-0.12.1/operators/ledger_python.html">ccf-0.12.1 </option>
            <option value="../../ccf-0.12.0/operators/ledger_python.html">ccf-0.12.0 </option>
            <option value="../../ccf-0.11.7/index.html">ccf-0.11.7 </option>
            <option value="../../ccf-0.11.4/index.html">ccf-0.11.4 </option>
            <option value="../../ccf-0.11.1/index.html">ccf-0.11.1 </option>
        </select>
        
</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#tutorial" class="nav-link">Tutorial</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#api" class="nav-link">API</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/Microsoft/CCF/edit/master/doc/operators/ledger_python.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="parsing-the-ledger-with-python">
<h1>Parsing the Ledger with Python<a class="headerlink" href="#parsing-the-ledger-with-python" title="Permalink to this headline">¶</a></h1>
<p>This page describes the Python API of the <code class="xref py py-class docutils literal notranslate"><span class="pre">ccf.ledger</span></code> module which can be used by auditors to parse a CCF ledger. To install the <cite>ccf</cite> Python package, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install ccf
</pre></div>
</div>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>This tutorial demonstrates how to parse the ledger produced by a CCF node. It shows a very basic example which loops through all transactions in the ledger and counts how many times all keys in a target key-value store table are updated.</p>
<p>First, the path to the ledger directory should be set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ledger_dir</span> <span class="o">=</span> <span class="s2">&quot;&lt;/path/to/ledger/dir&gt;&quot;</span> <span class="c1"># Path to ledger directory</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the ledger directory is created under the node directory.</p>
</div>
<p>Then, import the ledger module:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ccf.ledger</span>
</pre></div>
</div>
<p>In this particular example, a target table is set. This is a public table that can be read and audited from the ledger directly. In this example, the target table is the well-known <code class="docutils literal notranslate"><span class="pre">ccf.nodes</span></code> table that keeps track of all nodes in the network.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">target_table</span> <span class="o">=</span> <span class="s2">&quot;ccf.nodes&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In practice, it is likely that auditors will want to run more elaborate logic when parsing the ledger. For example, this might involve verifying signatures transactions or auditing governance operations and looping over multiple tables.</p>
</div>
<p>Finally, the ledger can be iterated over. For each transaction in the ledger, the public tables changed within that transaction are observed. If the target table is included, we loop through all keys and values modified in that transaction.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">target_table_changes</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Simple counter</span>

<span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">ledger</span><span class="p">:</span>
    <span class="c1"># Retrieve all public tables changed in transaction</span>
    <span class="n">public_tables</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_public_domain</span><span class="p">()</span><span class="o">.</span><span class="n">get_tables</span><span class="p">()</span>

    <span class="c1"># If target_table was changed, count the number of keys changed</span>
    <span class="k">if</span> <span class="n">target_table</span> <span class="ow">in</span> <span class="n">public_tables</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">public_tables</span><span class="p">[</span><span class="n">target_table</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">target_table_changes</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># A key was changed</span>
</pre></div>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="ccf.ledger.Ledger">
<em class="property">class </em><code class="sig-prename descclassname">ccf.ledger.</code><code class="sig-name descname">Ledger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">directory</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ccf/ledger.html#Ledger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.Ledger" title="Permalink to this definition">¶</a></dt>
<dd><p>Class used to parse and iterate over all <a class="reference internal" href="#ccf.ledger.Transaction" title="ccf.ledger.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccf.ledger.Transaction</span></code></a> stored in a CCF ledger.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – Ledger directory for a single CCF node.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="ccf.ledger.Transaction">
<em class="property">class </em><code class="sig-prename descclassname">ccf.ledger.</code><code class="sig-name descname">Transaction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ccf/ledger.html#Transaction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.Transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>A transaction represents one entry in the CCF ledger.</p>
<dl class="py method">
<dt id="ccf.ledger.Transaction.get_public_domain">
<code class="sig-name descname">get_public_domain</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span><a class="reference internal" href="#ccf.ledger.PublicDomain" title="ccf.ledger.PublicDomain">ccf.ledger.PublicDomain</a><span class="p">]</span><a class="reference internal" href="../_modules/ccf/ledger.html#Transaction.get_public_domain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.Transaction.get_public_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the public (i.e. non-encrypted) domain for that transaction.</p>
<p>Note: If the transaction is private-only, nothing is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="#ccf.ledger.PublicDomain" title="ccf.ledger.PublicDomain"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccf.ledger.PublicDomain</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="ccf.ledger.Transaction.get_public_tx">
<code class="sig-name descname">get_public_tx</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bytes<a class="reference internal" href="../_modules/ccf/ledger.html#Transaction.get_public_tx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.Transaction.get_public_tx" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns raw transaction bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Raw transaction bytes.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="ccf.ledger.PublicDomain">
<em class="property">class </em><code class="sig-prename descclassname">ccf.ledger.</code><code class="sig-name descname">PublicDomain</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buffer</span><span class="p">:</span> <span class="n">_io.BytesIO</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ccf/ledger.html#PublicDomain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.PublicDomain" title="Permalink to this definition">¶</a></dt>
<dd><p>All public tables within a <a class="reference internal" href="#ccf.ledger.Transaction" title="ccf.ledger.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccf.ledger.Transaction</span></code></a>.</p>
<dl class="py method">
<dt id="ccf.ledger.PublicDomain.get_tables">
<code class="sig-name descname">get_tables</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="../_modules/ccf/ledger.html#PublicDomain.get_tables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ccf.ledger.PublicDomain.get_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of all public tables (with their content) in a <a class="reference internal" href="#ccf.ledger.Transaction" title="ccf.ledger.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccf.ledger.Transaction</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Dictionnary of public tables with their content.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="ledger.html" title="previous page">Ledger</a>
    <a class='right-next' id="next-link" href="container.html" title="next page">Runtime Container</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, Microsoft Research.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>